name: çˆ¬å–æ‹›ç”Ÿè®¡åˆ’æ•°æ®

on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'çˆ¬å–æ¨¡å¼'
        required: true
        type: choice
        options:
          - 'test'    # æµ‹è¯•æ¨¡å¼ï¼š3æ‰€å­¦æ ¡ï¼Œ3å¹´æ•°æ®
          - 'sample'  # æ ·æœ¬æ¨¡å¼ï¼š10æ‰€å­¦æ ¡ï¼Œ3å¹´æ•°æ®
          - 'full'    # å®Œæ•´æ¨¡å¼ï¼šå…¨éƒ¨å­¦æ ¡ï¼Œ5å¹´æ•°æ®
        default: 'test'
      years:
        description: 'å¹´ä»½èŒƒå›´ï¼ˆå¯é€‰ï¼Œå¦‚ï¼š2025,2024,2023 æˆ– 2020-2025ï¼‰'
        required: false
        type: string
        default: ''
  
  schedule:
    # æ¯æœˆ1å·å‡Œæ™¨2ç‚¹è‡ªåŠ¨è¿è¡Œï¼ˆæ‹›ç”Ÿè®¡åˆ’é€šå¸¸æ¯å¹´æ›´æ–°ï¼‰
    - cron: '0 2 1 * *'

permissions:
  contents: write

jobs:
  crawl:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
      
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'
        
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: åˆ›å»ºæ•°æ®ç›®å½•
      run: mkdir -p data
    
    - name: çˆ¬å–æ‹›ç”Ÿè®¡åˆ’ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰
      if: ${{ github.event.inputs.mode == 'test' || github.event.inputs.mode == '' }}
      env:
        SAMPLE_SCHOOLS: '3'
        PLAN_YEARS: ${{ github.event.inputs.years || '2025,2024,2023' }}
      run: python -m crawlers.plans
    
    - name: çˆ¬å–æ‹›ç”Ÿè®¡åˆ’ï¼ˆæ ·æœ¬æ¨¡å¼ï¼‰
      if: ${{ github.event.inputs.mode == 'sample' }}
      env:
        SAMPLE_SCHOOLS: '10'
        PLAN_YEARS: ${{ github.event.inputs.years || '2025,2024,2023' }}
      run: python -m crawlers.plans
    
    - name: çˆ¬å–æ‹›ç”Ÿè®¡åˆ’ï¼ˆå®Œæ•´æ¨¡å¼ï¼‰
      if: ${{ github.event.inputs.mode == 'full' }}
      env:
        SAMPLE_SCHOOLS: '99999'
        PLAN_YEARS: ${{ github.event.inputs.years || '2021-2025' }}
      run: python -m crawlers.plans
      
    - name: æäº¤å¹¶æ¨é€æ›´æ”¹
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: 'ğŸ“Š æ›´æ–°æ‹›ç”Ÿè®¡åˆ’æ•°æ® [${{ github.event.inputs.mode }}] #${{ github.run_number }}'
        file_pattern: 'data/plans.json'
        commit_user_name: GitHub Action
        commit_user_email: action@github.com
